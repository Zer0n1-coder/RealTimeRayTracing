# 26.2 用于光线跟踪的着色器
光线追踪现在被紧密地集成到实时渲染API中，比如DirectX[59,91,92]和Vulkan。在本节中，我们将描述添加到这些应用编程接口中的不同类型的光线追踪着色器，因此可以与光栅化一起使用。作为这种组合的例子，我们可以首先使用光栅化生成一个G缓冲区(第20章)，然后从这些命中点发射光线，以生成反射和阴影[9,76]。我们称之为延迟光线追踪（deferred ray tracing）。类似于计算着色器（第3.10节），光线追踪着色器被分配到图形处理器，即在（像素）网格上。在本节中，我们遵循DXR[59]的命名约定，这是DirectX12的光线追踪扩充。有五种类型的光线追踪着色器[59,78]。  
1.ray generation shader;  
2.closest hit shader;  
3.miss shader;  
4.any hit shader;  
5.intersection shader.  
除了区间[tmin,tmax]之外，使用等式26.1定义光线。区间定义了射线中接受相交的部分。参见26.7.程序员可以给光线添加***payload***。这是一种用于在不同光线追踪着色器之间发送数据的数据结构。一根光线的***payload***可以包含一个float4类型的辐射率和一个float类型的命中点距离，但是用户可以添加任何需要的东西。然而，保持光线***payload***较小对性能更好，因为更大的***payload***可能使用更多的寄存器。  
***ray generation shader***是光线追踪的起点。它可以像计算着色器一样进行编程，并能够调用一个新的函数***TraceRay***，该函数类似于第26.1节中描述的***Trace***函数。通常，***ray generation shader***对屏幕的所有像素执行。***TraceRay***内部空间加速结构的快速遍历的实现是由驱动程序通过API提供的。可以定义连接到不同着色器的光线类型。例如，标准光线通常使用一组着色器，而阴影光线可以使用更简单的着色器。对于阴影，光线可以更有效地追踪，因为我们通常可以在光线的区间（从命中点到光源的范围）中找到任何相交点后立即停止。  
